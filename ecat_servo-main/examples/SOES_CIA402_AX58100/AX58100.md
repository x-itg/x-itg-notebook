## AX58100

There are differences between AX58100 and ET1100 when it comes to configuration. 

### As per datasheet:

- SCS_FUNC: Pullup high with 4K7 resistor is required for SPI operation

- Config Data: run `python3 .\patch_esi.py` to patch SDK generated `.bin` file for AX58100

- Watch SCS_ESC polarity and SPI mode

- NRST up

### ESC Configuration Area 

| Word    |   0x0   |   0x1   |   0x2   |   0x3   |   0x4   |   0x5   |   0x6   |   0x7   |
| Function|   PDI   |   PDI   |  SYNC   | Ext PDI |  Conf.  | Reservd | Reservd | Checksum|
| Function| Control | Config  |  Length | Config  | stat add| Reservd | Reservd | Checksum|
| Reg [0x]|0140:0141|0150:0151|0982:0983|0152:0153|0012:0013|    |    |    |    |0x1C:0x1F|
| Index   |  0 |  1 |  2 |  3 |  4 |  5 |  6 |  7 |  8 |  9 |  A |  B |  C |  D |  E |  F |   
| 0x00000 | 04 | 0F | 00 | 44 | 10 | 27 | 00 | F0 | 00 | 00 | 50 | 00 | 00 | 01 | EC | 00 |

esi.bin can be edited directly in SDK, in structured way. 

### As per Nucleo F3 demo ESI

```xml
<Eeprom>
  <ByteSize>2048</ByteSize>
  <ConfigData>050603440a00000000001a000000</ConfigData>
  <BootStrap>0010800000118000</BootStrap>
</Eeprom>
```
05 06 03 44 0A 00 00 00 00 00 1A 00 00 00 15 00
050603440A00000000001A0000001500

### As per Nucleo H7 demo ESI

```xml
<Eeprom>
  <ByteSize>2048</ByteSize>
  <ConfigData>050E03440A00000000001A000000</ConfigData>
  <BootStrap>0010800080108000</BootStrap>
</Eeprom>
```

For debugging checksum validation can be disabled by checksum value of 0x88A4. Obv. not for production, and SDK doesnt like it anyway - it still throws validation error

# MISC

- To visually diff binary file:

```bash
diff <(xxd cia402.bin) <(xxd cia402patched.bin)
```

- If slv_poll is the only thing in main(), sync manager watchdog kicks ESC right back into SAFEOP
- USB cable to power ESC on Discovery adapter is required


# STATUS

With .bin generated by SDK and manually patched, and EVB port 0 connected to laptop:

- Writing .bin to EEPROM works. After disconnecting and reboot, reading EEPROM outputs binary identical to input
- EEP_DONE is high - .bin seems to be OK
- After STM32 Discovery is connected, LED_ERR is low - no application error
- Slave with STM32 is reaching OP.
- Slave stays OP 30 min without issues
- DC mode is supported with stack in mixed mode