//////////////////////////////////////////////////////////////////////////////////	 
//±¾³ÌÐòÖ»¹©Ñ§Ï°Ê¹ÓÃ£¬Î´¾­×÷ÕßÐí¿É£¬²»µÃÓÃÓÚÆäËüÈÎºÎÓÃÍ¾
//ÖÐ¾°Ô°µç×Ó
//µêÆÌµØÖ·£ºhttp://shop73023976.taobao.com/?spm=2013.1.0.0.M4PqC2
//
//  ÎÄ ¼þ Ãû   : LCD_ZK.c
//  °æ ±¾ ºÅ   : v2.0
//  ×÷    Õß   : HuangKai
//  Éú³ÉÈÕÆÚ   : 2014-0101
//  ×î½üÐÞ¸Ä   : 
//  ¹¦ÄÜÃèÊö   : ×Ö¿â°æ OLED SPI½Ó¿ÚÑÝÊ¾Àý³Ì(STM32ÏµÁÐ)
//              ËµÃ÷: 
//              ------------------------ÒÔÏÂÎªOLEDÏÔÊ¾ËùÓÃµ½µÄ½Ó¿----------------------------------------
//              GND    µçÔ´µØ
//              VCC  ½Ó5V»ò3.3vµçÔ´
//              D0   PA2£¨CLK£©
//              D1   PA3£¨DIN£©
//              RES  PA4
//              DC   PA5
//              CS   PA1                
//              --------------------------ÒÔÉÏÎªOLEDÏÔÊ¾ËùÓÃµ½µÄ½Ó¿Ú--------------------------------------
//              ------------------------ÒÔÏÂÎªOLED×Ö¿â²¿·ÖËùÓÃµ½µÄ½Ó¿----------------------------------------
//              OUT   PB10	SPI	
//              IN  	PB11
//              SCK   PB9
//              CS2   PB7                
//              --------------------------ÒÔÉÏÎªOLED×Ö¿â²¿·ÖËùÓÃµ½µÄ½Ó¿Ú--------------------------------------
// ÐÞ¸ÄÀúÊ·   :
// ÈÕ    ÆÚ   : 
// ×÷    Õß   : HuangKai
// ÐÞ¸ÄÄÚÈÝ   : ´´½¨ÎÄ¼þ
//°æÈ¨ËùÓÐ£¬µÁ°æ±Ø¾¿¡£
//Copyright(C) ÖÐ¾°Ô°µç×Ó2014/3/16
//All rights reserved
//******************************************************************************/
#include "LCD_ZK.h"
#include "oled.h"

#define uchar unsigned char 
#define uint unsigned int
#define ulong unsigned long



unsigned char const bmp1[]={
  /*--  µ÷ÈëÁËÒ»·ùÍ¼Ïñ£ºD:\ÎÒµÄÎÄµµ\My Pictures\12864-555.bmp  --*/
  /*--  ¿í¶Èx¸ß¶È=128x64  --*/
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0xC0,0xC0,0xE0,0x60,0xE0,0xE0,0xE0,0xE0,0x60,
  0x60,0x60,0x60,0x60,0x60,0x60,0xE0,0xE0,0xE0,0xE0,0xC0,0xC0,0xC0,0xC0,0x80,0x80,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0x70,0x38,0x18,0x1C,0x0C,
  0x0E,0x07,0x03,0x03,0x01,0x81,0xE0,0x78,0x1C,0x0E,0x07,0x03,0x01,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x07,0x0E,0x1C,0x79,0xE1,0x83,
  0x03,0x07,0x0E,0x0C,0x1C,0x18,0x38,0x70,0xE0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0xC0,
  0xC0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
  0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
  0xE0,0xE0,0xE0,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x80,0xF0,0x78,0x1E,0x07,0x03,0x81,0x80,0xC0,0xC0,0xC0,0xE0,0x60,
  0x60,0x60,0x70,0xF0,0xFE,0x3F,0x19,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
  0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x38,0x31,0x3F,
  0xFE,0xF0,0x60,0x60,0xE0,0xC0,0xC0,0xC0,0x80,0x81,0x03,0x07,0x1E,0x78,0xF0,0x80,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xFC,0xFF,0x7F,0x07,0x0F,0x1F,0x3D,
  0x79,0x71,0xF0,0xE0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,
  0x80,0xC0,0xE0,0xF0,0x71,0x79,0x3D,0x1F,0x0F,0xFF,0xFE,0xFC,0x00,0x00,0x00,0x00,
  0x00,0x80,0xFE,0xFF,0xF9,0x1C,0x0E,0x07,0x03,0x03,0x01,0x01,0x00,0x00,0x00,0x00,
  0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x01,0x01,0x03,0x03,0x07,0x0E,0x1C,0xF9,0xFF,
  0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x01,0x03,0x07,0x0F,0x0E,0x9E,0xFC,0xF8,0xF0,0xE0,0xC0,0xC0,0x80,
  0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xC0,0xE0,0xF0,0xF8,0xF8,0xFC,0x9E,0x0F,0x07,
  0x03,0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,
  0x00,0x00,0x3F,0xFF,0xDF,0x38,0x70,0xE0,0xC0,0xC0,0x80,0x80,0x00,0x00,0x00,0x00,
  0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0xE0,0x70,0x38,0xDF,0xFF,
  0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
  0x80,0xC0,0xE0,0xF0,0x78,0x3C,0x1E,0x0F,0x07,0x03,0x01,0x00,0x01,0x01,0x03,0x07,
  0x0F,0x1E,0x1E,0x0E,0x0F,0x07,0x03,0x01,0x01,0x00,0x01,0x01,0x03,0x07,0x0F,0x1E,
  0x3C,0x78,0xF0,0xE0,0xC0,0x80,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x07,0x0F,0x3C,0x70,0xE0,0xC1,0x81,0x03,0x03,0x03,0x07,0x06,
  0x06,0x06,0x0E,0x0F,0x7F,0xFC,0x98,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
  0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x0C,0x8C,0xFC,
  0x7F,0x0F,0x06,0x06,0x07,0x03,0x03,0x03,0x81,0xC1,0xE0,0x70,0x3C,0x0F,0x07,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x1F,0x3F,0x7C,0xFC,0xFE,0xEF,
  0xE7,0xE3,0xE1,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
  0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
  0xE0,0xE0,0xE0,0xE1,0xE3,0xE7,0xEF,0xFE,0x7C,0x3F,0x1F,0x0F,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x07,0x0E,0x0C,0x1C,0x18,
  0x38,0x70,0x60,0xE0,0xC0,0xC1,0x87,0x9E,0xB8,0xF0,0xE0,0xC0,0x80,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0xF0,0xB8,0xDE,0xC7,0xE1,
  0x60,0x70,0x38,0x18,0x1C,0x0C,0x0E,0x07,0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x03,0x03,0x03,0x03,0x03,0x07,0x07,
  0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x03,0x03,0x03,0x01,0x01,0x01,0x01,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  
};


unsigned char const jiong1[]={/*--  ÎÄ×Ö:  ‡å  --*/
  /*--  ËÎÌå12;  ´Ë×ÖÌåÏÂ¶ÔÓ¦µÄµãÕóÎª£º¿íx¸ß=16x16   --*/
  0x00,0xFE,0x82,0x42,0xA2,0x9E,0x8A,0x82,0x86,0x8A,0xB2,0x62,0x02,0xFE,0x00,0x00,
  0x00,0x7F,0x40,0x40,0x7F,0x40,0x40,0x40,0x40,0x40,0x7F,0x40,0x40,0x7F,0x00,0x00};

unsigned char const lei1[]={/*--  ÎÄ×Ö:  ®š  --*/
  /*--  ËÎÌå12;  ´Ë×ÖÌåÏÂ¶ÔÓ¦µÄµãÕóÎª£º¿íx¸ß=16x16   --*/
  0x80,0x80,0x80,0xBF,0xA5,0xA5,0xA5,0x3F,0xA5,0xA5,0xA5,0xBF,0x80,0x80,0x80,0x00,
  0x7F,0x24,0x24,0x3F,0x24,0x24,0x7F,0x00,0x7F,0x24,0x24,0x3F,0x24,0x24,0x7F,0x00};

void OLED_GPIO_Config(void);
void GBZK_GPIO_Config(void);
#define nnus 20
extern void delay_us(volatile uint16_t us);
#define ROM_OUT    (GPIOB->IDR&(1<<3))//GPIO_ReadInputDataBit(GPIOB,GPIO_Pin_10)

void GBZK_ROMOUT_IN(void)
{		
  
  GPIO_InitTypeDef GPIO_InitStruct;
  GPIO_InitStruct.Pin = GPIO_PIN_3;//SPISO_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_INPUT;//GPIO_Mode_IPD
  GPIO_InitStruct.Pull = GPIO_PULLDOWN;
  HAL_GPIO_Init(GPIOB, &GPIO_InitStruct);	  	 
  
}

void GBZK_ROMOUT_OUT(void)
{		
  GPIO_InitTypeDef GPIO_InitStruct;
  GPIO_InitStruct.Pin = GPIO_PIN_3;//SPISO_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_OD;//GPIO_Mode_Out_OD
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  HAL_GPIO_Init(GPIOB, &GPIO_InitStruct);		  	 
}


 

 

/*ÑÓÊ±*/
void delay(int n_ms)               
{
  int j,k;
  for(j=0;j<n_ms;j++)
    for(k=0;k<5500;k++);
}


/*µÈ´ýÒ»¸ö°´¼ü£¬ÎÒµÄÖ÷°åÊÇÓÃP2.0ÓëGNDÖ®¼ä½ÓÒ»¸ö°´¼ü*/
#if 0
void waitkey()
{
repeat:
  if (P2&0x01) goto repeat;
  else delay(6);
  if (P2&0x01) goto repeat;
  else
    delay(40);;
}
#endif


void Rom_CS(unsigned char a)
{
  if (a){
    GPIOB->BSRR=(1<<5);
  }else	{
    GPIOB->BRR=(1<<5);
  }
}
void Rom_IN(unsigned char a)
{
  if (a)
    GPIOA->BSRR=(1<<15);
  else		
    GPIOA->BRR=(1<<15);
}

void Rom_SCK(unsigned char a)
{
  if (a)	
    GPIOB->BSRR=(1<<4);
  else		
    GPIOB->BRR=(1<<4);
}

void Rom_OUT(unsigned char a)
{
  if (a)	
    GPIOB->BSRR=(1<<3);
  else		
    GPIOB->BRR=(1<<3);
}

/*LCDÄ£¿é³õÊ¼»¯*/
void initial_rom(void)
{
  Rom_CS(1);
}

void lcd_address(uchar page,uchar column)
{

}



/****ËÍÖ¸Áîµ½¾§ÁªÑ¶×Ö¿âIC***/
void send_command_to_ROM( uchar datu )
{
  uchar i;
  for(i=0;i<8;i++ )
  {
    if(datu&0x80)
    {
      Rom_IN(1);;;
      delay_us(nnus);
    }
    else
    {
      Rom_IN(0);;; 
      delay_us(nnus); 
    }
    datu = datu<<1;
    Rom_SCK(0);;;
    delay_us(nnus);
    Rom_SCK(1);;;
    delay_us(nnus);
  }
}

/****´Ó¾§ÁªÑ¶×Ö¿âICÖÐÈ¡ºº×Ö»ò×Ö·ûÊý¾Ý£¨1¸ö×Ö½Ú£©***/
static uchar get_data_from_ROM( )
{
  
  uchar i;
  uchar ret_data=0;
  Rom_SCK(1);;; 
  
  delay_us(nnus);

  for(i=0;i<8;i++)
  {
    //GBZK_ROMOUT_OUT();//Êä³ö
    //delay_us(nnus);
    //Rom_OUT(1);;; 
    
    delay_us(nnus);
    Rom_SCK(0);;;
    
    delay_us(nnus);
    //GBZK_ROMOUT_IN();//ÊäÈë
    //delay_us(nnus);
    
    ret_data=ret_data<<1;
    
    if( ROM_OUT!=0 )
    {
      ret_data=ret_data+1;;;
      delay_us(nnus);
    }
    else
    {
      ret_data=ret_data+0;;;
      delay_us(nnus);	
    }
    Rom_SCK(1);
  }

  return(ret_data);
}



/*´ÓÏà¹ØµØÖ·£¨addrHigh£ºµØÖ·¸ß×Ö½Ú,addrMid£ºµØÖ·ÖÐ×Ö½Ú,addrLow£ºµØÖ·µÍ×Ö½Ú£©ÖÐÁ¬Ðø¶Á³öDataLen¸ö×Ö½ÚµÄÊý¾Ýµ½ pBuffµÄµØÖ·*/
/*Á¬Ðø¶ÁÈ¡*/
void get_n_bytes_data_from_ROM(uchar addrHigh,uchar addrMid,uchar addrLow,uchar *pBuff,uchar DataLen )
{
  uchar i;
  Rom_CS(0);
  Rom_SCK(0);
  send_command_to_ROM(0x03);
  send_command_to_ROM(addrHigh);
  send_command_to_ROM(addrMid);
  send_command_to_ROM(addrLow);
  for(i = 0; i < DataLen; i++ )
  {
    *(pBuff+i) =get_data_from_ROM();
  }
  Rom_CS(1);
}


/******************************************************************/

ulong  fontaddr=0;

void display_GB2312_string(uchar y,uchar x,uchar *text)
{
  unsigned char posx=0,posy=0,xsnum=0;
  unsigned char nullshow[16]={0};
  uchar i= 0;
  uchar addrHigh,addrMid,addrLow ;
  uchar fontbuf[32];			
  while((text[i]>0x00))
  {
    if((((text[i]>=0xb0) &&(text[i]<=0xf7))&&(text[i+1]>=0xa1)))
    {						
      
      fontaddr = (text[i]- 0xb0)*94; 
      fontaddr += (text[i+1]-0xa1)+846;
      fontaddr = (ulong)(fontaddr*32);
      
      addrHigh = (fontaddr&0xff0000)>>16;  
      addrMid = (fontaddr&0xff00)>>8;      
      addrLow = fontaddr&0xff;	    
      get_n_bytes_data_from_ROM(addrHigh,addrMid,addrLow,fontbuf,32 );
      OLED_16X16(x,y,fontbuf);//
       xsnum=xsnum+2;
       posx=posx+16;
       if(posx>127)
       {
         posx=0;
         posy=2;
       }
      //display_graphic_16x16(y,x,fontbuf);
      i+=2;
      x+=16;
    }
    else if(((text[i]>=0xa1) &&(text[i]<=0xa3))&&(text[i+1]>=0xa1))
    {						
     
      fontaddr = (text[i]- 0xa1)*94; 
      fontaddr += (text[i+1]-0xa1);
      fontaddr = (ulong)(fontaddr*32);
      
      addrHigh = (fontaddr&0xff0000)>>16;  
      addrMid = (fontaddr&0xff00)>>8;      
      addrLow = fontaddr&0xff;	     
      get_n_bytes_data_from_ROM(addrHigh,addrMid,addrLow,fontbuf,32 );

      OLED_16X16(x,y,fontbuf);//
      xsnum=xsnum+2;
       posx=posx+16;
       if(posx>127)
       {
         posx=0;
         posy=2;
       }
      //display_graphic_16x16(y,x,fontbuf);
      i+=2;
      x+=16;
    }
    else if((text[i]>=0x20) &&(text[i]<=0x7e))	
    {
      unsigned char see=text[i];
      unsigned char fontbuf[16];			
      fontaddr = (text[i]- 0x20);
      fontaddr = (unsigned long)(fontaddr*16);
      fontaddr = (unsigned long)(fontaddr+0x3cf80);			
      addrHigh = (fontaddr&0xff0000)>>16;
      addrMid = (fontaddr&0xff00)>>8;
      addrLow = fontaddr&0xff;
      
      get_n_bytes_data_from_ROM(addrHigh,addrMid,addrLow,fontbuf,16 );
      
      OLED_8X16(x,y,fontbuf);
     
      xsnum=xsnum+1;
      posx=posx+8;
      if(posx>127)
       {
         posx=0;
         posy=2;
       }
       
      //display_graphic_8x16(y,x,fontbuf);
      i+=1;
      x+=8;
    }
    else
      i++;
  }
  
 
}

void display_string_5x7(uchar y,uchar x,uchar *text)
{
  unsigned char i= 0;
  unsigned char addrHigh,addrMid,addrLow ;
  while((text[i]>0x00))
  {
    if((text[i]>=0x20) &&(text[i]<=0x7e))	
    {						
      unsigned char fontbuf[8];			
      fontaddr = (text[i]- 0x20);
      fontaddr = (unsigned long)(fontaddr*8);
      fontaddr = (unsigned long)(fontaddr+0x3bfc0);			
      addrHigh = (fontaddr&0xff0000)>>16;
      addrMid = (fontaddr&0xff00)>>8;
      addrLow = fontaddr&0xff;
      
      get_n_bytes_data_from_ROM(addrHigh,addrMid,addrLow,fontbuf,8);/*È¡8¸ö×Ö½ÚµÄÊý¾Ý£¬´æµ½"fontbuf[32]"*/
      
      display_graphic_5x7(y,x,fontbuf);/*ÏÔÊ¾5x7µÄASCII×Öµ½LCDÉÏ£¬yÎªÒ³µØÖ·£¬xÎªÁÐµØÖ·£¬fontbuf[]ÎªÊý¾Ý*/
      i+=1;
      x+=6;
    }
    else
      i++;	
  }
  
}


